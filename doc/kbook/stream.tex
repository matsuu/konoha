\chapter{システムとコンテキスト}\section{言語処理系}\section{ガベージ・コレクション}\section{オペレーティングシステム}\subsection{バーチャル変数 os}\begin{quote}\begin{jverbatim}\end{jverbatim}\end{quote}\section{環境変数}\subsection{バーチャル変数 os}\begin{quote}\begin{jverbatim}\end{jverbatim}\end{quote}\section{コンテキスト Context}\section{プロパティ変数}\chapter{ストリーム}入出力ストリームは、よく抽象化されたデータ構造である。様々なリソースが入出力ストリームのソースとして利用でき、伝統的なオブジェクト指向クラス設計では、これらのクラスを階層構造で設計する。例えば、Java は、{ｴsf InputStream} クラスを抽象クラスとして、{ｴsf FileInputStream}, {ｴsf ByteArrayInputStream}, {ｴsf SocketInputStream}などのサブクラスでストリームの種類が実現している。しかし、Konoha では、C言語レベルのコンポジットパターンでストリームの種類を抽象化し、{\sf InputStream} と {ｴsf OutputStream}の２つから様々な種類のストリームを扱うことを可能にしている。\section{{\sf InputStream}: 入力ストリーム}{\sf InputStream} は、入力ストリームを抽象化したクラスである。\subsection{入力ストリームの種類}それでは、入力ストリームの種類はどうやって指定するのかと言えば、タグで識別します。\begin{quote}\begin{jverbatim}in = new InputStream("file:file.txt");foreach(String line from in) {  print line;}in.close()\end{jverbatim}\end{quote} 主な入力ストリームとタグの種類は次の通りです。\begin{itemize}\item{\bf \verb|file:|} - ファイルシステム上のファイルを識別する。(省略可能)\item{\bf \verb|http:|} - Webサーバ上のファイル。(using socket が必要)\item{\bf \verb|pipe:|} - パイプによるコマンドの実行結果。(using unix が必要。)\end{itemize}バイト列のような内部リソースから新しい入力ストリームをラッピングするときは、マップキャストを使います。\begin{quote}\begin{jverbatim}>>> b = new byte[1024];>>> in = (InputStream)b;\end{jverbatim}\end{quote}\subsection{テキストの読み込み}\subsection{データの読み込み}\section{{\sf OutputStream}}\section{ファイル}\section{パイプ}パイプは、プロセス間通信の最もシンプルで広く使われている方法です。Konoha では、UNIX(互換)パッケージを用いることで、{\sf InputStream} か {\sf OutputStream} のどちらをパイプに連結することができます。パイプを識別するタグは、\verb|'pipe:'|, \verb|'sh:'|, \verb|'cmd:'| のどれかです。\subsection{外部プログラムからデータを受ける}パイプが最も活躍するシチュエーションは、外部のコマンド（プログラム）を起動し、その実行結果をえるときです。次は、UNIX コマンド(ls)を実行し、その実行結果を1行ずつ表示するスクリプトの例です。Windows の場合は、ls コマンドがないので、代わりに dir で試してみましょう。\begin{quote}\begin{jverbatim}using unix.*;in = new InputStream("pipe:ls -l");foreach(line from in) {  print line;}in.close()\end{jverbatim}\end{quote}\subsection{外部プログラムへデータを送信する}パイプでは、{\sf InputStream} の代わりに、{\sf OutputStream}を用いれば、ストリームをとしてデータの送信が可能になります。\begin{comment}パイプが最も活躍するシチュエーションは、外部のコマンド（プログラム）を起動し、その実行結果をえるときです。次は、UNIX コマンド(ls)を実行し、その実行結果を1行ずつ表示するスクリプトの例です。Windows の場合は、ls コマンドがないので、代わりに dir で試してみましょう。\begin{quote}\begin{jverbatim}using unix.*;in = new InputStream("pipe:ls -l");foreach(line from in) {  print line;}in.close()\end{jverbatim}\end{quote}\end{comment}\section{Socket}